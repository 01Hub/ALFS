<package name="daemontools" version="&daemontools-version;">

	<stage name="Unpacking a package.">
		<unpack>
			<archive>&packages_dir;/&daemontools-package;</archive>
			<destination>&build_dir;</destination>
		</unpack>
	</stage>

	<stage name="Installing a package.">
		<stageinfo>
			<base>&build_dir;/&daemontools-directory;/daemontools-&daemontools-version;</base>
		</stageinfo>

		<execute command="./package/compile" />

		<search_replace>
		        <file>package/boot.inittab</file>
		        <find>command</find>
		        <replace>usr/sbin</replace>
		</search_replace>

		<search_replace>
		        <file>command/svscanboot</file>
		        <find>/command:/usr/local/bin:/usr/local/sbin:</find>
		        <replace></replace>
		</search_replace>

		<search_replace>
		        <file>command/svscanboot</file>
		        <find>command</find>
		        <replace>usr/sbin</replace>
		</search_replace>

		<search_replace>
		        <file>command/svscanboot</file>
		        <find>/service</find>
		        <replace>/etc/service</replace>
		</search_replace>
		
		<permissions mode="555">
		        <name>command/svscanboot</name>
		</permissions>

		<copy>
		        <source>command/*</source>
		        <destination>/usr/sbin</destination>
		</copy>
		
		<execute command="cat /etc/inittab package/boot.inittab > /etc/inittab~" />
		<execute command="mv -f /etc/inittab~ /etc/inittab" />

		<mkdir base="/etc">
		         <option>parents</option>
		         <name>service</name>
		</mkdir>

		<execute command="telinit Q" />
		
	</stage>

	<stage name="Clean-up.">
		<remove>&build_dir;/&daemontools-directory;</remove>
	</stage>

</package>
