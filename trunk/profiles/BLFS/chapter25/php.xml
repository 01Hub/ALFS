<package name="php" version="&php-version;">

        <packageinfo>
                <requires><name>openssl</name></requires>
                <requires><name>bc</name></requires>
                <requires><name>curl</name></requires>
                <requires><name>db</name></requires>
                <requires><name>libjpeg</name></requires>
                <requires><name>libpng</name></requires>
                <requires><name>freetype</name></requires>
                <requires><name>mysql</name></requires>
                <requires><name>apache</name></requires>

                <utilizes><name>gdbm</name></utilizes>
                <utilizes><name>sendmail</name></utilizes>
                <utilizes><name>pcre</name></utilizes>
                <utilizes><name>postgesql</name></utilizes>
                <utilizes><name>readline</name></utilizes>
                <utilizes><name>libtiff</name></utilizes>
                <utilizes><name>readline</name></utilizes>
                <utilizes><name>expat</name></utilizes>
                <utilizes><name>gmp</name></utilizes>
        </packageinfo>

	<stage name="Unpacking a package.">
		<unpack>
			<archive>&packages_dir;/&php-package;</archive>
			<destination>&build_dir;</destination>
		</unpack>
	</stage>

	<stage name="Installing a package.">
		<stageinfo>
			<base>&build_dir;/&php-directory;</base>
		</stageinfo>


		<execute command="grep php:  /etc/group  || groupadd">
		        <param>php</param>
		</execute>
		


		<execute command="id -u php || useradd">
		        <param>-c php</param>
			<param>-d /home/ftp</param>
			<param>-g php</param>
			<param>-s /bin/false</param>
			<param>php</param>
		</execute>


		<configure>
		        <param>--prefix=/usr</param>
			<param>--with-apxs2=/usr/sbin/apxs</param>
			<param>--with-config-file-path=/etc</param>
			<param>--with-openssl=/usr</param>
			<param>--with-zlib=/usr</param>
			<param>--enable-bcmath</param>
			<param>--with-bz2=/usr</param>
			<param>--with-curl</param>
			<param>--enable-ftp</param>
			<param>--with-gd</param>
			<param>--with-jpeg-dir=/usr</param>
			<param>--enable-gd-native-ttf</param>
			<param>--with-db4</param>
			<param>--with-png-dir=/usr</param>
			<param>--with-freetype-dir=/usr</param>
			<param>--with-gettext</param>
			<param>--with-mysql=/usr</param>
			<param>--with-ncurses</param>
			<param>--sysconfdir=/etc</param>
		</configure>

		<make />

		<make>
			<param>install</param>
		</make>

		<copy>
		        <source>php.ini-dist</source>
			<destination>/etc/php.ini</destination>
		</copy>

	</stage>


	<stage name="Configuring a package.">

	<!-- remove line if already inserted -->
	<search_replace base="/etc/apache">
		<file>httpd.conf</file>
		<find>AddType application/x-httpd-php .php</find>
		<replace></replace>
	</search_replace>
	
	<textdump mode="append" base="/etc/apache">
	        <file>httpd.conf</file>
		<content>
                =AddType application/x-httpd-php .php
		</content>
	</textdump>	
	

	</stage>


	<stage name="Clean-up.">
		<remove>&build_dir;/&php-directory;</remove>
	</stage>

</package>
