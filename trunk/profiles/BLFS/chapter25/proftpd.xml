<package name="proftpd" version="&proftpd-version;">

        <packageinfo>
                <requires><name>linuxpam</name></requires>
        </packageinfo>

	<stage name="Unpacking a package.">
		<unpack>
			<archive>&packages_dir;/&proftpd-package;</archive>
			<destination>&build_dir;</destination>
		</unpack>
	</stage>

	<stage name="Installing a package.">
		<stageinfo>
			<base>&build_dir;/&proftpd-directory;</base>
		</stageinfo>


		<execute command="grep proftpd:  /etc/group  || groupadd">
		        <param>proftpd</param>
		</execute>
		


		<execute command="id -u proftpd || useradd">
		        <param>-c proftpd</param>
			<param>-d /home/ftp</param>
			<param>-g proftpd</param>
			<param>-s /bin/false</param>
			<param>proftpd</param>
		</execute>


		<configure command="install_user=proftpd install_group=proftpd ./configure">                        
		        <param>--prefix=/usr</param>
                        <param>--sysconfdir=/etc</param>
                        <param>--localstatedir=/var</param>
		</configure>

		<make />

		<make>
			<param>install</param>
		</make>

	</stage>


	<stage name="Configuring a package.">

		<textdump base="/etc">
		<file>proftpd.conf</file>
		<content>

		=# This is a basic ProFTPD configuration file
		=# It establishes a single server and a single anonymous login.
		=
		=ServerName			"ProFTPD Default Installation"
		=ServerType			standalone
		=DefaultServer			on
		=
		=# Port 21 is the standard FTP port.
		=Port				21
		=# Umask 022 is a good standard umask to prevent new dirs and files
		=# from being group and world writable.
		=Umask				022
		=
		=# To prevent DoS attacks, set the maximum number of child processes
		=# to 30.  If you need to allow more than 30 concurrent connections
		=# at once, simply increase this value.  Note that this ONLY works
		=# in standalone mode, in inetd mode you should use an inetd server
		=# that allows you to limit maximum number of processes per service
		=# (such as xinetd)
		=MaxInstances			30
		=
		=# Set the user and group that the server normally runs at.
		=User				proftpd
		=Group				proftpd
		=
		=# Normally, we want files to be overwriteable.
		=&lt;Directory /*>
		=  AllowOverwrite		on
		=&lt;/Directory>
		=
		=# A basic anonymous configuration, no upload directories.
		=&lt;Anonymous ~proftpd>
		=  User				proftpd
		=  Group				proftpd
		=  # We want clients to be able to login with "anonymous" as well as "proftpd"
		=  UserAlias			anonymous proftpd
		=
		=  # Limit the maximum number of anonymous logins
		=  MaxClients			10
		=
		=  # We want 'welcome.msg' displayed at login, and '.message' displayed
		=  # in each newly chdired directory.
		=  DisplayLogin			welcome.msg
		=  DisplayFirstChdir		.message
		=
		=  # Limit WRITE everywhere in the anonymous chroot
		=  &lt;Limit WRITE>
		=    DenyAll
		=  &lt;/Limit>
		=&lt;/Anonymous>

		</content>
		</textdump>

		<textdump base="/etc/rc.d/init.d">
		<file>proftpd</file>
		<content>

		=#!/bin/sh
		=# Begin $rc_base/init.d/proftpd
		=
		=# Based on sysklogd script from LFS-3.1 and earlier.
		=# Rewritten by Gerard Beekmans  - gerard@linuxfromscratch.org
		=
		=source /etc/sysconfig/rc
		=source $rc_functions
		=
		=case "$1" in
		=        start)
		=	        echo "Starting FTP Server..."
		=	        loadproc /usr/sbin/proftpd
		=	        ;;
		=
		=	stop)
		=	        echo "Stopping FTP Server..."
		=	        killproc /usr/sbin/proftpd
		=	        ;;
		=
		=	reload)
		=	        echo "Reloading FTP Server..."
		=	        reloadproc /usr/sbin/proftpd
		=	        ;;
		=	     
		=	restart)
		=	        $0 stop
		=	        sleep 1
		=	        $0 start
		=	        ;;
		=
		=	status)
		=	        statusproc /usr/sbin/proftpd
		=	        ;;
		=
		=	*)
		=	        echo "Usage: $0 {start|stop|reload|restart|status}"
		=	        exit 1
		=	        ;;
		=esac
		=
		=# End $rc_base/init.d/proftpd

		</content>
		</textdump>


		<permissions mode="755">
		        <name>/etc/rc.d/init.d/proftpd</name>
		</permissions>

		<link base="/etc/rc.d/init.d">
		        <option>force</option>
			<target>../init.d/proftpd</target>
			<name>../rc0.d/K50proftpd</name>
		</link>

		<link base="/etc/rc.d/init.d">
		        <option>force</option>
			<target>../init.d/proftpd</target>
			<name>../rc1.d/K50proftpd</name>
		</link>

		<link base="/etc/rc.d/init.d">
		        <option>force</option>
			<target>../init.d/proftpd</target>
			<name>../rc2.d/K50proftpd</name>
		</link>

		<link base="/etc/rc.d/init.d">
		        <option>force</option>
			<target>../init.d/proftpd</target>
			<name>../rc3.d/S50proftpd</name>
		</link>

		<link base="/etc/rc.d/init.d">
		        <option>force</option>
			<target>../init.d/proftpd</target>
			<name>../rc4.d/S50proftpd</name>
		</link>

		<link base="/etc/rc.d/init.d">
		        <option>force</option>
			<target>../init.d/proftpd</target>
			<name>../rc5.d/S50proftpd</name>
		</link>

		<link base="/etc/rc.d/init.d">
		        <option>force</option>
			<target>../init.d/proftpd</target>
			<name>../rc6.d/K50proftpd</name>
		</link>


	</stage>


	<stage name="Clean-up.">
		<remove>&build_dir;/&proftpd-directory;</remove>
	</stage>

</package>
